<!DOCTYPE html>

<html>

<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-68403134-2"></script>
	<script>
		window.dataLayer = window.dataLayer || [];

		function gtag() {
			dataLayer.push(arguments);
		}
		gtag('js', new Date());

		gtag('config', 'UA-68403134-2');
	</script>

	<meta charset="utf-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Latest compiled and minified CSS -->

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" crossorigin="anonymous"></script>

	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="style.css">
	<script>
		window.addEventListener("hashchange", function() {
			scrollBy(0, -60)
		})
	</script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
	<script src="../highlight.pack.js"></script>
	<script>
		hljs.initHighlightingOnLoad();
	</script>

	<title>
		CS503: Operating Systems, Spring 22 -- XINU setup guide
	</title>

</head>

<body>



	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top ">
		<div class="container">
			<a class="navbar-brand" href="#overview">CS503: Operating Systems, Spring 22</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav ml-auto">
					<!--li class="nav-item active">
              <a class="nav-link" href="#overview">Overview
                <span class="sr-only">(current)</span>
              </a>
            </li-->
				</ul>
			</div>
		</div>
	</nav>


	<p>
		<!-- =============================================================================  -->
		<div class="container">
			<h1 id="overview">
				XINU Setup Guide
			</h1>


			<p>This XINU setup guide describes several important steps that you will
				need to perform to start XINU development and submit your work for grading:</p>

			<ul>
				<li>Set up the XINU project and get the initial XINU code.</li>
				<li>Log in to a XINU Lab frontend PC.</li>
				<li>View the status of existing XINU backends.</li>
				<li>Load a built XINU image onto a XINU backend and successfully boot the image.</li>
				<li>Modify the XINU source code initialize.c, which creates
					the first XINU application process that executes function main()
					(located in system/main.c).</li>
				<li>Turn in the project.</li>
			</ul>



			<p> Throughout the semester you must maintain your projects using the
				<em>GitHub classroom</em> system.
				Projects will be published through
				<em>GitHub Classroom</em> and you must regularly commit and push your changes
				(e.g., at least every couple of hours of work or more often) to
				your GitHub Classroom private git repository.
				In case you need to access the XINU tarball without using
				git, refer to section 7 of this guide). </p>

			<p> Recall that the projects are <strong>individual</strong> and it is your
				responsibility to prevent other students from accessing your code in
				any way (e.g., ensure the repository is private and that your files in the
				CS machines are protected with the appropriate permissions).
				Please refer to the course policy on plagiarism for additional
				details.
			</p>

			<p> The following are prerequisites for executing this XINU setup guide:</p>
			<ol>
				<li> A <a href="http://www.github.com">github.com</a> account.
					If you do not yet have one,
					please <a href="https://github.com/join">sign up</a> for a free Github account.</li>
				<li> Familiarity with basic git operations.
					Knowing basic git commands such as `git clone`, `git status`, `git add`,
					`git commit`, and `git push` should be good enough. If necessary,
					please refer to existing
					<a href="https://product.hubspot.com/blog/git-and-github-tutorial-for-beginners">tutorials</a>
					and <a href="https://git-scm.com/doc">references</a>.
				</li>
			</ol>



			<h2> 1. Setup project on github </h3>


				<p>We will announce and release the project setup link through <a href="https://piazza.come">Piazza</a>.
					Clicking on the setup link will bring you to the following page:

					<ul>
						<li>
							1.1. If it is your first time using github classroom, you need to
							grant the access of <em>github classroom</em> and choose your
							classroom ID.</li>

						<img src="./img/img01.png" alt="Grant Accessing" style="height:200px;border:3px solid LightGray;" />
						<img src="./img/img02.png" alt="Pickup ID" style="height:200px;border:3px solid LightGray;" />
						</br>
						</br>

						<li> 1.2. Accept the assignment.</li>

						<img src="./img/img03.png" alt="Accept assignment" style="height:200px;border:3px solid LightGray;" />
						<img src="./img/img04.png" alt="Success" style="height:200px;border:3px solid LightGray;" />
						</br>
						</br>
						<li> 1.3. As the image indicates, your project repository will have the
							format: <em>https://github.com/purdue-cs503-spring22/&lt;projectName&gt;-&lt;yourId&gt;/</em> </li>
						</br>
					</ul>


					<h2> 2. Development workflow</h2>
					<p>
						In case you forget the project repository name, you can go to
						<a href="https://github.com/purdue-cs503-spring22">https://github.com/purdue-cs503-spring22</a>
						to find it.
						For illustration purposes, we will <strong>assume</strong> that your project is under
						'<em>github.com/purdue-cs503-spring22/lab0-jonsnow</em>' and your Purdue
						account is '<strong>jonsnow</strong>'.
					</p>


					<ul>
						<li> 2.1. Log into a frontend machine </li>

						<br />
						Log into one of the 21 frontend machines: <em>xinu01.cs.purdue.edu</em>, <em>xinu02.cs.purdue.edu,</em> ..., <em>xinu21.cs.purdue.edu</em>, physically or remotely.
						<p> For example, you can use <code>ssh jonsnow@xinu01.cs.purdue.edu</code> under <em>terminal</em> for Linux/MacOS/Windows or <em>PuTTY</em> for old Windows versions.
						</p>

						<p>
							If you have any trouble with
							your account and its setup, please see the <a href='http://www.cs.purdue.edu/help'>department help pages</a>. If these pages do not address your particular problem,
							please use the trouble command from the command line to report the problem.
						</p>

						<li>
							2.2. Setup environment variables to access the backend machines </li>
						</br>

						<p> Adding <em>/p/xinu/bin/</em> to your environment variable:</p>
						<pre><code>$ export PATH=${PATH}:/p/xinu/bin</code></pre>

						<p> If you do not want to manually type it each time, you can also
							put the above command in your shell profile (i.e. <code> ~/.bashrc</code>)
							so that the PATH environment variable is automatically set each time you login.
						</p>

						<p> Run <code>source .bashrc</code> (or its equivalent) to make the change take effect.
						</p>


						<li> 2.3. Clone the project repository</li>
						</br>

						<p>For example, to clone the repository in a new my503 folder in
							your home directory you should execute the following commands: </p>
						<pre><code>$ mkdir -p ~/my503/; cd ~/my503/;
$ git clone https://github.com/purdue-cs503-spring22/Lab0-jonsnow.git
$ cd Lab0-jonsnow/xinu-cs503-spring2022/
$ ls
compile  config  DESCRIPTION  device  include  lib  net  shell  system</code></pre>
						<p>If you encounter the following error when logging in:</p>
						<pre><code>remote: Support for password authentication was removed on August 13, 2021. Please use a personal access token instead.
remote: Please see https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/ for more information.
fatal: unable to access "..." : The requested URL returned error: 403</code></pre>
						<p>see this <a href="https://stackoverflow.com/questions/68775869/support-for-password-authentication-was-removed-please-use-a-personal-access-to">post</a> for help.</p>

						<p> This project folder, <em>xinu-cs503-spring2022</em>, would be your project1's <strong> root directory</strong>. </p>


						<li> 2.4. Modify the source code as needed </li>
						</br>

						<li>2.5. Compile the project </li>
						</br>

						<p>
							The <em>Makefile</em> is under <em>./compile</em> folder.</p>
						<pre><code>$ cd compile
$ make
</code></pre>

						<p> Note that in some cases (e.g., when adding new files) you
							need to run `make clean` before `make` to
							reload header modifications, otherwise your build might be incomplete.</p>

						<p>If successfully compiled, a <em>xinu</em> file will be generated
							under the same folder. </p>


						<!-- replace step2.6 and step2.7 by origianl xinu-setup section3 "Running XINU"
						<li>2.6 Connect to a backend machine</li>
						<br />
						<pre><code>$ cs-console
connection 'galileo104', class 'quark', host 'xinuserver.cs.purdue.edu'</code></pre>
						<p>The <em>console system</em> will automatically find one of the available machines. You can check `cs-console -h` for more details.
						</p>
						<li>2.7 Trigger the backend <em>command input</em> mode</li>
						<br />
						<p> Press <kbd>control</kbd>+<kbd>shift</kbd>+<kbd>2</kbd> or
							<kbd>control</kbd>+<kbd>space</kbd> to active command-mode within cs-console. </p>
						<p> (<strong>d</strong> for download to board. <strong>p</strong>
							for power cycle reboot. <strong>q</strong> for quit backend.) </p>
						<pre><code>(command-mode) d
file: xinu
</code></pre>
						<p> The backend machine will flash your code into its ROM. </p>
						<pre><code>(command-mode) p</code></pre>
						<p> The backend machine will reboot to execute your code.</p>
						<p>
							After several seconds
							XINU should boot with a "Welcome to Xinu!" message that looks something like this:
						</p>
-->

						<li>2.6 Running XINU</li>
						<br />
						<p>
							The executable XINU binary runs on a selected backend machine. We have 96
							dedicated backends: <b>galileo101.cs.purdue.edu</b>, ...,
							<b>galileo196.cs.purdue.edu</b>.
							The backends are all
							<a href="http://www.intel.com/content/www/us/en/do-it-yourself/galileo-maker-quark-board.html">Intel
								Galileo</a> development boards which run the
							<a href="http://www.intel.com/content/www/us/en/processors/quark/intel-quark-technologies.html">quark</a>
							system-on-chip processor.
						</p>

						<p>
							The backend machines are shared resources. When a backend machine is
							grabbed by a student,
							it is dedicated for use by that student to run his/her version of XINU.
							To see which backends are available for booting XINU, type:
						</p>

						<pre><code class="bash">% cs-status -c quark</code></pre>

						<p>
							This will show you who is using each backend and how
							long they have been using it. As with all hardware,
							sometimes they fail and may become unavailable until repaired
							by our technical staff.
						</p>

						<p>
							To boot your copy of XINU on a backend, connect
							to a back-end by issuing the command:
							<pre><code class="bash">% cs-console [galileo1__]</code></pre>
							With no arguments cs-console will connect you to the first available backend (including broken ones).
							Occasionally, backend hardware malfunctions. If you suspect this to be the case, please inform the TAs.
						</p>

						<p>
							To load your copy of XINU onto a selected backend execute the following commands within cs-console:
						</p>

						<ol>
							<li>
								<kbd>Control</kbd>+<kbd>@</kbd> OR <kbd>Control</kbd>+<kbd>Spacebar</kbd> &nbsp;&nbsp;&nbsp;&nbsp;// Escape to local command-mode
							</li>

							<li>
								(command-mode) <kbd>d</kbd>&nbsp;&nbsp;&nbsp;&nbsp;// Download command
							</li>

							<li>
								file: xinu &nbsp;&nbsp;&nbsp;&nbsp;// Download the file 'xinu' (this example assumes that you are inside the /compile directory)
							</li>

							<li>
								<kbd>Control</kbd>+<kbd>@</kbd> OR <kbd>Control</kbd>+<kbd>Spacebar</kbd>&nbsp;&nbsp;&nbsp;&nbsp;// Escape to local command-mode&nbsp;
							</li>

							<li>
								(command-mode) <kbd>p</kbd>&nbsp;&nbsp;&nbsp;&nbsp; // Power cycle command: power cycle the backend
							</li>
						</pre>
						</ol>

						<p>
							In addition to <kbd>d</kbd> and <kbd>p</kbd>, in command-mode, there are several other commands that may be useful. Type <kbd>h</kbd> after entering command-mode to get a list and description of the commands.
						</p>

						<p>
							After several seconds
							XINU should boot with a "Welcome to Xinu!" message that looks something like this:
						</p>


						<pre><code class="plaintext">
Xinu for galileo -- version #11  (comer)  Fri Feb 17 15:47:10 EST 2017


Ethernet Link is Up
MAC address is 98:4f:ee:00:0a:a2
 250088592 bytes of free memory.  Free list:
           [0x00159370 to 0x0EFD8FFF]
           [0x0FDEF000 to 0x0FDEFFFF]
    104653 bytes of Xinu code.
           [0x00100000 to 0x001198CC]
    132936 bytes of data.
           [0x0011CCE0 to 0x0013D427]

Obtained IP address  128.10.136.103   (0x800a8867)


------------------------------------------
   __    __   _____    _   _    _    _
   \ \  / /  |__ __|  | \ | |  | |  | |
    \ \/ /     | |    |  \| |  | |  | |
    / /\ \    _| |_   | \   |  | |  | |
   / /  \ \  |     |  | | \ |  \  --  /
   --    --   -----    -   -     ----
------------------------------------------


Welcome to Xinu!


xsh $

</code></pre>

						<p>

							To disconnect and free up the backend:
						</p>

						<ol>
							<li>
								<kbd>Control</kbd>+<kbd>@</kbd> OR <kbd>Control</kbd>+<kbd>Spacebar</kbd>
							</li>
							<li>
								(command-mode) <kbd>p</kbd>&nbsp;&nbsp;&nbsp;&nbsp;// Power cycle command: Power cycle the backend; wait until you see "Press [Enter] ..."
							</li>
							<li>
								<kbd>Control</kbd>+<kbd>@</kbd> OR <kbd>Control</kbd>+<kbd>Spacebar</kbd>
							</li>
							<li>
								(command-mode) <kbd>q</kbd>&nbsp;&nbsp;&nbsp;&nbsp;// Quit command
							</li>
						</ol>

						<br />
						<div class="alert alert-danger">

							<strong>NOTE:</strong> Please make sure to disconnect from the backend when you are no longer actively using it. This will let other users reuse the backend.

						</div>



						<br>

						<li> 2.7. Commit your changes </li>
						<br />
						<p> You are <strong>required</strong> to commit and push your changes frequently
							(e.g., at least every couple of hours of work or more often) to your git repository.
							This will be important to help you recover from bad changes,
							communicate with your TA, and enforce the course policies. Failure
							to comply with this requirement in any assignment will result in
							lost points or a zero grade in the assignment.</p>
						<ul>
							<li> a. Check repository modifications </li>
							<pre><code class="plaintext">git status</code></pre>

							<li> b. Add all modifications so that the git system collects the modifications.</li>
							<pre><code class="plaintext">git add &lt;the modified files&gt; </code></pre>

							<li>c. Commit modification so that the git system will document your modifications. </li>
							<pre><code class="plaintext">git commit -m "A brief sentence about the modification."</code></pre>
							<p>(You can also use `git commit` to provide more detailed description.</p>

							<li>d. After <em>commit</em> all modification and <em>git status</em> shows all clear. Push the local modifications to sync with the server. </li>

							<pre><code class="plaintext">git push</code></pre>

						</ul>

				</p>
				</ul>




				<h2>3. Turn-in your work</h2>

				<p>Reminder: <em>Github Classroom</em> <strong>is not</strong> used to submit work,
					you must use Purdue's turn-in system and only your last submission will be saved. Hence, make sure your last submission is made before the project deadline.</p>


				1. Required output format:
				<ul>
					<li>
						For labs that ask to <strong>print messages</strong>
						using kprintf() or printf(), you must use
						conditional compilation (e.g., C preprocessor directives #if and #define)
						with the macro XTEST appropriately set to 1 or 0 (in include/process.h).
						XTEST will toggle between
						print and no print and will be critical for grading. I.e., XTEST==1: print assignment messages,
						XTEST==0: do not print assignment messages.
					</li>
					<li>
						For your own <strong>debug messages</strong>, do the same but use the macro XDEBUG. I.e., XDEBUG==1: print your debug messages, XDEBUG==0: do not print your debug messages.
					</li>
				</ul>


				<p>
					2. Before submitting your work, make sure to double-check the
					TA Notes in Piazza
					to ensure that additional requirements and instructions have been followed.
				</p>

				<p>
					3. Please make sure to disable all debugging output before submitting your code.
				</p>

				<p>
					4. Electronic turn-in instructions:
				</p>
				<ol>
					<li>
						Go to the xinu-cs503-spring2022/compile directory and run <code class="bash"> make clean</code>.
					</li>

					<li>
						Go to the directory of which your xinu-cs503-spring2022 directory
						is a subdirectory.
						E.g., if /homes/bob/xinu-cs503-spring2022 is your directory
						structure, go to /homes/bob.
						(Note: please do not rename xinu-cs503-spring2022 or any of its subdirectories.)
					</li>

					<li>Type the following command to turn in the files:
						<pre><code class="bash">turnin -c cs503 -p labX xinu-cs503-spring2022
</code></pre>
					</li>

					<li> List and check the submitted files with the following command:
						<pre><code class="bash"> turnin -c cs503 -p labX -v
</pre></code>
					</li>
				</ol>



				<h2>4. Troubleshooting</h2>

				<ol>
					<li>Use of non-bash shells. In the unlikely case that you need to use
						other shells, we show the mapping from bash to tcsh that is
						required to correctly set up the environment.
						The mapping is as follows:
						1. Edit <b>.cshrc</b> instead of <b>.bashrc</b>.
						2. Add a line <b>setenv PATH ${PATH}:/p/xinu/bin</b> instead of <b>export PATH=${PATH}:/p/xinu/bin</b>.
						3. Run <b>tcsh</b> instead of <b>source .bashrc</b>.
					<li>In case of setup problems, try to figure out what is going on by
						yourself first and check very carefully that you followed accurately the
						instructions in this guide.
					<li>When XINU crashes or otherwise misbehaves
						(i.e., does not do what you intended
						when programming the kernel) then debug the problem(s) and try again.
						Since your version of the XINU kernel runs on dedicated hardware,
						you are in full control.
						That is, there are no hidden side effects introduced by other
						software layers that you are not privy to.
						By the same token, everything rests on your shoulders.
					<li>If you get repeatedly stuck with "Booting XINU on ... ",
						please contact the TAs.
					<li>If you are not able to get a free backend, please contact the
						TAs.
					<li><strong>Check regularly Piazza</strong> for updates and
						clarifications about the project.
				</ol>


				<h2>5. Remote Login</h2>
				<p>
					The XINU lab is located in HASS257. There are 21 Linux frontend machines xinu01.cs.purdue.edu, xinu02.cs.purdue.edu,
					..., xinu21.cs.purdue.edu, which can access and control 96 backend
					machines galileo101.cs.purdue.edu, galileo102.cs.purdue.edu,
					..., galileo196.cs.purdue.edu.
				</p>

				<p>
					The frontend machines serve as operating system code development
					(coding, compiling, deploying, etc). Frontend machines could be either accessed
					physically or remotely via TLA/SSL applications such as <em>ssh</em>
					on Linux/MacOS/Windows. The backend machines are <strong>x86
						Intel</strong> Galileo boards equipped with <strong>Quark
						X1000</strong> processors that are dedicated to running your XINU OS
					code. The backend can be accessed through the <em>cs-console</em>
					system from any of the frontend machines.
				</p>
				<p>
					Use of the backends is limited to implementing, testing, and evaluating
					lab assignments of CS 503.
				</p>
				<!--
                                To access the backends, you don't
				have to be physically present in the XINU lab. You can remote login
				using ssh to one of the lab's frontend machines.
                        -->



				<h2>6. An Example App: XINU Shell</h2>
				<p>
					By default, when XINU boots up, it runs a shell (xsh). To view all the
					usable shell commands, run the help command:
				</p>
				<pre><code class="plaintext">xsh $ help

shell commands are:

argecho      date         help         netinfo      udp          ?
arp          devdump      kill         ping         udpecho
cat          echo         memdump      ps           udpeserver
clear        exit         memstat      sleep        uptime
</code></pre>
				<p>
					Take a moment to run some shell commands and view their output.
					In particular, run the ps command which lists
					information about running processes.
				</p>
				<pre><code class="plaintext">xsh $ ps
Pid Name             State Prio Ppid Stack Base Stack Ptr  Stack Size
--- ---------------- ----- ---- ---- ---------- ---------- ----------
  0 prnull           ready    0    0 0x0EFDEFFC 0x0EFDEEC0     8192
  1 rdsproc          wait   200    0 0x0EFDCFFC 0x0EFDCAAC    16384
  2 Main process     recv    20    2 0x0EFD8FFC 0x0EFD8F64    65536
  3 shell            recv    50    3 0x0EFC8FFC 0x0EFC8C6C     8192
  4 ps               curr    20    4 0x0EFC6FFC 0x0EFC6E18     8192
</code></pre>
				<p>
					Here you can see the several pieces of information for all processes
					currently running. The name gives some detail about what the process
					is intended for. XINU always contains a special process with process
					identifier (pid) 0 called the null process (or prnull). This process
					is the first process created by XINU and is always ready to execute.
					Unlike other processes, prnull is handcrafted without using create().
					The inclusion of this process ensures that there is always something
					for XINU to execute even if all other processes have finished or are
					waiting for something. By default, UNIX/Linux and Windows have similar
					null or idle processes.
				</p>



				<h2>7. Accessing XINU tarball source files without git</h2>

				<p>
					You should <strong>not</strong> need to get a XINU tarball since
					your git repository should automatically be initialized with it.
					But you can perform the following steps to access it in the unlikely
					event that you need it:
					<ol>
						<li>Log into the frontend machines. </li>
						<li>Unpack the tarball:</li>
						<pre><code class="bash">$ tar zxvf /homes/cs503/xinu-cs503-spring2022.tar.gz
</code></pre>
						<li>In <code class="bash">xinu-cs503-spring2022/compile/Makefile
</code>, change the compiler to <code class="bash">gcc-7
</code>.</li>

					</ol>

					<p>After executing these steps in your home directory, you should now
						have a <i>xinu-cs503-spring2022</i> directory.
						The subdirectories under this directory contain the source code, header files,
						configuration files, and Makefile for compiling XINU.</p>


				</p>


				<hr><a href="../index.html">Back to the CS503 web page</a><br>


		</div>
	</p>

	<!-- Footer -->
	<footer id="footer">
		<div class="container text-right">
			<div class="col-lg-12">
				<p>
					<small class="text-muted text-right">Last update:</small>
			</div>
		</div>
	</footer>
</body>

</html>
